var e=require("react"),t=require("@pixi/react"),r=require("path"),n=require("pixi.js"),i=require("tmx-parser");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=u(e),o=u(r),l=u(i);function f(){return f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},f.apply(this,arguments)}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var p=e.createContext(),d=function(e,r,i){var u=function(e,t){for(var r,n,i=s(t);!(n=i()).done;){var u=n.value;e>=u.firstGid&&(r=u)}return r}(r.gid,i.tileSets);if(u){var l=r.x,f=r.width,c=r.height,p=function(e,t,r){var i=r.image,u=r.tileHeight,a=r.tileWidth,l=e.gid-r.firstGid,f=l%(i.width/a)*a,c=Math.floor(l/(i.height/u))*u,s=o.default.dirname(t.path),p=n.Texture.from(s+"/"+r.image.source);return new n.Texture(p,new n.Rectangle(f,c,u,a))}(r,i,u),d=r.y;return"object"===e&&(d-=c),a.default.createElement(t.Sprite,{key:"("+l+","+d+")",texture:p,x:l,y:d,width:f,height:c})}},h=function(r){var n=r.layer,i=r.map;if(!n.visible)return null;var u=e.useMemo(function(){return"tile"===n.type?function(e,t){for(var r=[],n=0;n<t.height;n++)for(var i=0;i<t.width;i++){var u=e.tiles[i+n*t.width];(null==u?void 0:u.gid)>0&&r.push(d("tile",u,t))}return r}(n,i):"object"===n.type?function(e,t){return e.objects.map(function(e){if(e.gid)return d("object",e,t)})}(n,i):void 0},[n]);return a.default.createElement(t.Container,{alpha:n.opacity},u)},v=function(){var t=e.useContext(p).map;return e.useMemo(function(){return t.layers.filter(function(e){return"object"===e.type}).map(function(e){return e.objects}).flat()},[t])};exports.Tilemap=function(r){var n=r.map,i=r.children,u=function(e,t){if(null==e)return{};var r,n,i={},u=Object.keys(e);for(n=0;n<u.length;n++)t.indexOf(r=u[n])>=0||(i[r]=e[r]);return i}(r,["map","children"]),o=e.useState(!1),l=o[0],f=o[1],c=e.useMemo(function(){return null==n?void 0:n.layers.map(function(e,t){return"Foreground"===e.name?(f(!0),i):a.default.createElement(h,{key:t,layer:e,map:n})})},[n,i]);return n?a.default.createElement(p.Provider,{value:{map:n}},a.default.createElement(t.Container,u,c,!l&&i)):null},exports.useCollisions=function(){var t=e.useContext(p).map;return e.useMemo(function(){return t.layers.filter(function(e){return"tile"===e.type}).map(function(e){for(var t,r=[],i=s(e.tiles);!(t=i()).done;){var u=t.value;if(u){var a=u.objectGroups;if(a.length>0)for(var o,l=s(a);!(o=l()).done;){var f=o.value;r.push(new n.Rectangle(u.x+f.x,u.y+f.y,f.width,f.height))}}}return r}).flat()},[t])},exports.useInteractables=function(){var t=v();return e.useMemo(function(){for(var e,r=[],n=s(t);!(e=n()).done;){var i=e.value;i.properties.isInteractable&&r.push(i)}return r},[t])},exports.useMap=function(){return e.useContext(p).map},exports.useObjects=v,exports.useSpawnPoint=function(){var t=v();return e.useMemo(function(){var e=t.find(function(e){return"Spawn"===e.name});return new n.Point(e.x+e.width/2,e.y+e.height/2)})},exports.useTilemapLoader=function(t){var r=e.useState(null),n=r[0],i=r[1];return e.useEffect(function(){l.default.parseFile(t,function(e,r){if(e)throw e;r.layers=r.layers.map(function(e){var t;return f({},e,{tiles:null==(t=e.tiles)?void 0:t.map(function(e,t){return f({},e,{x:t%r.width*r.tileWidth,y:Math.floor(t/r.width)*r.tileHeight,width:r.tileWidth,height:r.tileHeight})})})}),r.path=t,i(r)})},[t]),n},exports.useTiles=function(){var t=e.useContext(p).map,r=e.useState([]),n=r[0],i=r[1];return e.useEffect(function(){if(t){var e=t.layers.filter(function(e){return"tile"===e.type}).map(function(e){return e.tiles}).flat().filter(function(e){return null!==e});i(e)}},[t]),n};
//# sourceMappingURL=index.js.map
