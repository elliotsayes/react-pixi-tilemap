!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("@pixi/react"),require("path"),require("pixi.js"),require("tmx-parser")):"function"==typeof define&&define.amd?define(["exports","react","@pixi/react","path","pixi.js","tmx-parser"],t):t((e||self).reactPixiTilemap={},e.react,e.react,e.path,e.pixi_js,e.tmxParser)}(this,function(e,t,r,n,i,u){function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=a(t),f=a(n),l=a(u);function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c.apply(this,arguments)}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d=t.createContext(),h=function(e,t,n){var u=function(e,t){for(var r,n,i=p(t);!(n=i()).done;){var u=n.value;e>=u.firstGid&&(r=u)}return r}(t.gid,n.tileSets);if(u){var a=t.x,l=t.width,c=t.height,s=function(e,t,r){var n=r.image,u=r.tileHeight,a=r.tileWidth,o=e.gid-r.firstGid,l=o%(n.width/a)*a,c=Math.floor(o/(n.height/u))*u,s=f.default.dirname(t.path),p=i.Texture.from(s+"/"+r.image.source);return new i.Texture(p,new i.Rectangle(l,c,u,a))}(t,n,u),d=t.y;return"object"===e&&(d-=c),o.default.createElement(r.Sprite,{key:"("+a+","+d+")",texture:s,x:a,y:d,width:l,height:c})}},v=function(e){var n=e.layer,i=e.map;if(!n.visible)return null;var u=t.useMemo(function(){return"tile"===n.type?function(e,t){for(var r=[],n=0;n<t.height;n++)for(var i=0;i<t.width;i++){var u=e.tiles[i+n*t.width];(null==u?void 0:u.gid)>0&&r.push(h("tile",u,t))}return r}(n,i):"object"===n.type?function(e,t){return e.objects.map(function(e){if(e.gid)return h("object",e,t)})}(n,i):void 0},[n]);return o.default.createElement(r.Container,{alpha:n.opacity},u)};l.default.readFile=function(e,t){fetch(e).then(function(e){return e.text()}).then(function(e){return t(e)})};var m=function(){var e=t.useContext(d).map;return t.useMemo(function(){return e.layers.filter(function(e){return"object"===e.type}).map(function(e){return e.objects}).flat()},[e])};e.Tilemap=function(e){var n=e.map,i=e.children,u=function(e,t){if(null==e)return{};var r,n,i={},u=Object.keys(e);for(n=0;n<u.length;n++)t.indexOf(r=u[n])>=0||(i[r]=e[r]);return i}(e,["map","children"]),a=t.useState(!1),f=a[0],l=a[1],c=t.useMemo(function(){return null==n?void 0:n.layers.map(function(e,t){return"Foreground"===e.name?(l(!0),i):o.default.createElement(v,{key:t,layer:e,map:n})})},[n,i]);return n?o.default.createElement(d.Provider,{value:{map:n}},o.default.createElement(r.Container,u,c,!f&&i)):null},e.useCollisions=function(){var e=t.useContext(d).map;return t.useMemo(function(){return e.layers.filter(function(e){return"tile"===e.type}).map(function(e){for(var t,r=[],n=p(e.tiles);!(t=n()).done;){var u=t.value;if(u){var a=u.objectGroups;if(a.length>0)for(var o,f=p(a);!(o=f()).done;){var l=o.value;r.push(new i.Rectangle(u.x+l.x,u.y+l.y,l.width,l.height))}}}return r}).flat()},[e])},e.useInteractables=function(){var e=m();return t.useMemo(function(){for(var t,r=[],n=p(e);!(t=n()).done;){var i=t.value;i.properties.isInteractable&&r.push(i)}return r},[e])},e.useMap=function(){return t.useContext(d).map},e.useObjects=m,e.useSpawnPoint=function(){var e=m();return t.useMemo(function(){var t=e.find(function(e){return"Spawn"===e.name});return new i.Point(t.x+t.width/2,t.y+t.height/2)})},e.useTilemapLoader=function(e){var r=t.useState(null),n=r[0],i=r[1];return t.useEffect(function(){l.default.parseFile(e,function(t,r){if(t)throw t;r.layers=r.layers.map(function(e){var t;return c({},e,{tiles:null==(t=e.tiles)?void 0:t.map(function(e,t){return c({},e,{x:t%r.width*r.tileWidth,y:Math.floor(t/r.width)*r.tileHeight,width:r.tileWidth,height:r.tileHeight})})})}),r.path=e,i(r)})},[e]),n},e.useTiles=function(){var e=t.useContext(d).map,r=t.useState([]),n=r[0],i=r[1];return t.useEffect(function(){if(e){var t=e.layers.filter(function(e){return"tile"===e.type}).map(function(e){return e.tiles}).flat().filter(function(e){return null!==e});i(t)}},[e]),n}});
//# sourceMappingURL=index.umd.js.map
