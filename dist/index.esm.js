import t,{createContext as r,useMemo as e,useState as n,useEffect as i,useContext as a}from"react";import{Sprite as o,Container as u}from"@pixi/react";import l from"path";import{Texture as f,Rectangle as c,Point as p}from"pixi.js";import h from"tmx-parser";function v(){return v=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},v.apply(this,arguments)}function m(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function s(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return m(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?m(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d=r(),y=function(r,e,n){var i=function(t,r){for(var e,n,i=s(r);!(n=i()).done;){var a=n.value;t>=a.firstGid&&(e=a)}return e}(e.gid,n.tileSets);if(i){var a=e.x,u=e.width,p=e.height,h=function(t,r,e){var n=e.image,i=e.tileHeight,a=e.tileWidth,o=t.gid-e.firstGid,u=o%(n.width/a)*a,p=Math.floor(o/(n.height/i))*i,h=l.dirname(r.path),v=f.from(h+"/"+e.image.source);return new f(v,new c(u,p,i,a))}(e,n,i),v=e.y;return"object"===r&&(v-=p),t.createElement(o,{key:"("+a+","+v+")",texture:h,x:a,y:v,width:u,height:p})}},g=function(r){var n=r.layer,i=r.map;if(!n.visible)return null;var a=e(function(){return"tile"===n.type?function(t,r){for(var e=[],n=0;n<r.height;n++)for(var i=0;i<r.width;i++){var a=t.tiles[i+n*r.width];(null==a?void 0:a.gid)>0&&e.push(y("tile",a,r))}return e}(n,i):"object"===n.type?function(t,r){return t.objects.map(function(t){if(t.gid)return y("object",t,r)})}(n,i):void 0},[n]);return t.createElement(u,{alpha:n.opacity},a)},b=function(r){var i=r.map,a=r.children,o=function(t,r){if(null==t)return{};var e,n,i={},a=Object.keys(t);for(n=0;n<a.length;n++)r.indexOf(e=a[n])>=0||(i[e]=t[e]);return i}(r,["map","children"]),l=n(!1),f=l[0],c=l[1],p=e(function(){return null==i?void 0:i.layers.map(function(r,e){return"Foreground"===r.name?(c(!0),a):t.createElement(g,{key:e,layer:r,map:i})})},[i,a]);return i?t.createElement(d.Provider,{value:{map:i}},t.createElement(u,o,p,!f&&a)):null},w=function(t){var r=n(null),e=r[0],a=r[1];return i(function(){h.parseFile(t,function(r,e){if(r)throw r;e.layers=e.layers.map(function(t){var r;return v({},t,{tiles:null==(r=t.tiles)?void 0:r.map(function(t,r){return v({},t,{x:r%e.width*e.tileWidth,y:Math.floor(r/e.width)*e.tileHeight,width:e.tileWidth,height:e.tileHeight})})})}),e.path=t,a(e)})},[t]),e},j=function(){return a(d).map},x=function(){var t=a(d).map;return e(function(){return t.layers.filter(function(t){return"object"===t.type}).map(function(t){return t.objects}).flat()},[t])},O=function(){var t=x();return e(function(){var r=t.find(function(t){return"Spawn"===t.name});return new p(r.x+r.width/2,r.y+r.height/2)})},S=function(){var t=a(d).map;return e(function(){return t.layers.filter(function(t){return"tile"===t.type}).map(function(t){for(var r,e=[],n=s(t.tiles);!(r=n()).done;){var i=r.value;if(i){var a=i.objectGroups;if(a.length>0)for(var o,u=s(a);!(o=u()).done;){var l=o.value;e.push(new c(i.x+l.x,i.y+l.y,l.width,l.height))}}}return e}).flat()},[t])},A=function(){var t=x();return e(function(){for(var r,e=[],n=s(t);!(r=n()).done;){var i=r.value;i.properties.isInteractable&&e.push(i)}return e},[t])},E=function(){var t=a(d).map,r=n([]),e=r[0],o=r[1];return i(function(){if(t){var r=t.layers.filter(function(t){return"tile"===t.type}).map(function(t){return t.tiles}).flat().filter(function(t){return null!==t});o(r)}},[t]),e};export{b as Tilemap,S as useCollisions,A as useInteractables,j as useMap,x as useObjects,O as useSpawnPoint,w as useTilemapLoader,E as useTiles};
//# sourceMappingURL=index.esm.js.map
